<!DOCTYPE html>
<html lang="en">
<head>
  <% include ../../snippets/header %>
</head>
<body>
  <% include ../../snippets/navbar %>
  <div class="container main">
    <div class="row">
      <div class="two columns">
        <% include ../../snippets/settingsSubnav %>
      </div>
      <div class="ten columns">
        <div id="note">
          <%=messages%>
        </div>
        <h3>Subscription</h3>
        <% if (session.user.tierID === 1) { %>
          <p>You don't currently have an active subscription.<br>Check out the available upgrade options <a href="upgrade" class='green'>here</a>.</p>
          <% } else {
            if (tier.results === 0) tier.results = "unlimited";
            if (tier.apis === 0) tier.apis = "unlimited";
          %>


          <% if (session.subscription.status === 3) { %>
            <p>You are currently on the <span class='green'><%= tier.name %></span> tier, however, your account is currently on hold due to an unpaid subscription charge.<br><br>
            Please either revert to the <span class='green'>Free</span> tier by canceling your subscription, or click on the <span class='green'><%= tier.name %></span> tier upgrade button below to restart your subscription.</p>
            </p>
          <% } else { %>
            <p>You are currently on the <span class='green'><%= tier.name %></span> tier.<br>
            This plan gives you<br>
            -<span class='green'><%= tier.memory/1024/1024 %></span> MB of list memory<br>
            -<span class='green' id="dailyResults"><%= tier.results %></span> daily results<br>
            -<span class='green' id="resultsPerRequest"><%= tier.per %></span> results per request<br>
            -<span class='green'><%= tier.apis %></span> APIs at a rate of <span class='green' id="price">$<%= tier.price %></span> per month.<br><br>
            <% if (subscription.status === 2) { %>
                 Your account will be downgraded to the <span class='green'>free</span> tier at the end of your subscription period.<br>
                 Your current subscription will end on <span class='green' id="renewalDate"><%= subscription.current_period_end %></span>.<br><br>
              <input type='button' class='greenButton' id='restartSubscription' value='Restart Subscription'>
            <% } else { %>
                 Your current subscription will be renewed on <span class='green' id="renewalDate"><%= subscription.current_period_end %></span>.<br><br>
                 <input type='button' class='redButton' id='cancelSubscription' value='Cancel Subscription'>
            <% } %>
          <% } %>
          </p>
          <% if (tier.name !== "Premium") { %>
            <h4>Available upgrades</h4>
            <div class="card">
              <div class="title" style="color: #0CB863">Premium</div>
              <div class="pricing">$5.00<span class='subpricing'> / month</span></div>
              <div class="info">
                <ul>
                  <li><span id="main">unlimited</span> daily results</li>
                  <li><span id="main">2,500</span> results / request</li>
                  <li><span id="main">25 MB</span> list data</li>
                  <li><span id="main">unlimited</span> APIs</li>
                  <li id='upgradeButton'>
                    <input type="button" id="upgradeSubscription" value="Upgrade">
                  </li>
                </ul>
              </div>
            </div>
          <% } %>
        <% } %>
      </div>
    </div>
  </div>
  <% include ../../snippets/footer %>
  <script src="js/moment.min.js"></script>
  <script src="js/subscription.js"></script>
</body>
</html>
